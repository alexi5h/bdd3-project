DROP PROCEDURE IF EXISTS PA_INSERT_ESTADISTICAS ;
DELIMITER &&
CREATE PROCEDURE PA_INSERT_ESTADISTICAS ()
BEGIN 

 
INSERT INTO ESTADISTICAS(NOMBRE_CURSO,NRO_INSTANCIA,NOM_APE_PROFESOR,FECHA_INICIO,
						  FECHA_FIN, NRO_ESTUDIANTES,TOTAL_POR_MATRICULAS)
SELECT CU.NOMBRE, CE.NRO_EDICION, CONCAT(PE.NOMBRES, CONCAT(" ",PE.APELLIDOS)) AS NOMBRE_APELLIDO
      ,CE.FECHA_INICIO,CE.FECHA_FINALIZACION,CE.NRO_ESTUDIANTES,CE.NRO_ESTUDIANTES*40 AS VALOR
FROM CURSO_EDICION CE INNER JOIN CURSO CU ON CU.ID=CE.CURSO_ID
                      INNER JOIN CURSO_EDICION_HAS_PERSONAS CEP ON CEP.CURSO_EDICION_ID=CE.ID
				      INNER JOIN PERSONA PE ON CEP.PERSONA_ID=PE.ID
WHERE PE.TIPO_PERSONA=3;
END
&&
DELIMITER ;

CALL PA_INSERT_ESTADISTICAS ();


